# AGENTS.md - Распределение ролей между агентами

## Принцип разделения

| Роль | Модель | Когда использовать |
|---|---|---|
| **Планирование, архитектура, ревью** | Claude Opus | Проектирование фич, анализ кода, принятие архитектурных решений, code review, написание спецификаций |
| **Кодинг, реализация, рефакторинг** | Claude Sonnet | Написание кода, исправление багов, рефакторинг, написание тестов, реализация по готовому плану |

**Opus думает, Sonnet делает.**

Opus дороже и медленнее, но лучше в рассуждениях и сложных решениях. Sonnet быстрее и дешевле — идеален для написания кода по чёткому ТЗ.

## Workflow

1. **Opus** анализирует задачу, исследует кодовую базу, составляет план
2. **Opus** описывает что именно нужно сделать (какие файлы, какие изменения, почему)
3. **Sonnet** получает план и реализует код
4. **Opus** ревьюит результат, проверяет на ошибки и соответствие архитектуре

## Команды для агентов

### Планирование (Opus)

```bash
# Анализ задачи и создание плана
claude --model opus "Проанализируй текущую архитектуру проекта и предложи план для [описание задачи]"

# Code review
claude --model opus "Сделай ревью последних изменений. Проверь архитектуру, edge cases, безопасность"

# Архитектурное решение
claude --model opus "Сравни подходы A и B для [задача]. Какой лучше и почему?"

# Исследование бага
claude --model opus "Исследуй баг: [описание]. Найди root cause и предложи план фикса"
```

### Кодинг (Sonnet)

```bash
# Реализация по плану
claude --model sonnet "Реализуй по плану: [вставить план от Opus]"

# Фикс бага
claude --model sonnet "Исправь баг в [файл]: [описание проблемы и решения]"

# Рефакторинг
claude --model sonnet "Вынеси общий код get_oura_data() и send_telegram_message() в shared.py"

# Написание тестов
claude --model sonnet "Напиши unit-тесты для alert_monitor.py: check_alerts(), filter_duplicate_alerts()"
```

### Быстрые задачи (Haiku)

```bash
# Простые правки, форматирование, тривиальные фиксы
claude --model haiku "Убери хардкод токена из oura_telegram_daily.py строка 14"

# Генерация boilerplate
claude --model haiku "Добавь docstring к функциям в alert_monitor.py"
```

## Примеры для этого проекта

### Пример: Добавление новой фичи

**Шаг 1 — Opus (план):**
```
Задача: добавить SpO2 в ежедневный отчёт.
Проанализируй как сейчас формируется отчёт в oura_telegram_daily.py,
какие данные уже запрашиваются, и предложи план интеграции SpO2.
```

**Шаг 2 — Sonnet (код):**
```
Реализуй по плану:
1. В generate_daily_report() добавить запрос usercollection/daily_spo2
2. Добавить секцию SpO2 после секции стресса
3. Показывать предупреждение если SpO2 < 95%
```

**Шаг 3 — Opus (ревью):**
```
Проверь реализацию SpO2 в ежедневном отчёте. Всё ли учтено?
Edge cases? Что если данных нет?
```

### Пример: Устранение техдолга

**Шаг 1 — Opus (план):**
```
В проекте get_oura_data() и send_telegram_message() дублируются в 3 файлах.
Спроектируй общий модуль. Учти: alert_monitor использует другой дефолт для OURA_TOKEN,
scheduler импортирует check_sleep_completed из daily.
```

**Шаг 2 — Sonnet (код):**
```
Создай oura_common.py по плану:
- Перенеси get_oura_data(), send_telegram_message(), конфиг переменных
- Обнови импорты в daily, weekly, alert_monitor
- Проверь что scheduler.py не ломается
```

## Правила

- Не запускай Opus для тривиальных правок — это пустая трата денег
- Не запускай Sonnet для архитектурных решений — он может упустить нюансы
- Всегда передавай Sonnet конкретный план, а не абстрактную задачу
- После кодинга Sonnet — ревью Opus, если изменения затрагивают архитектуру
- Для задач < 10 строк кода можно обойтись одним Sonnet без планирования
